```{r}
# Requirements: Bioconductor packages topGO and Rgraphviz for visualisation

library(topGO)
library(tidyverse)
select <- dplyr::select
go_data <- read_tsv("./PlasmoDBPutativeFunctions.txt")

# This is a demo - actually set this variable to this list of gene IDs where you want to test for enrichment
interesting_gene_ids <- (go_data %>% filter(grepl("GO:0003743", `Computed GO Function IDs`)))$`Gene ID`



go_mapping_df <- go_data %>%
  dplyr::select(c(`Gene ID`, contains("GO") & contains("IDs"))) %>%
  pivot_longer(-`Gene ID`, names_to = "type", values_to = "go_id") %>%
  separate_rows(go_id, sep = ";")

# NB we could filter on type here to separate out computed/curated
# go_mapping_df %>% filter(grepl("Curated",type))

go_mapping_df <- go_mapping_df %>%
  dplyr::select(`Gene ID`, go_id) %>%
  distinct() %>%
  filter(go_id != "N/A") %>%
  group_by(`Gene ID`) %>%
  summarise(go_id = list(go_id))

mapping <- go_mapping_df$go_id
names(mapping) <- go_mapping_df$`Gene ID`

gene_names <- factor(as.integer(go_data$`Gene ID` %in% c(interesting_gene_ids)))
names(gene_names) <- go_data$`Gene ID`
# If the universe of genes you are interested in is not the whole set then filter the gene_names variable accordingly.


# Change the ontology to BP/MF/CC to run on different GO ontologies

GOdata <- new("topGOdata", ontology = "MF", allGenes = gene_names, annot = annFUN.gene2GO, gene2GO = mapping)


# You can run any number of types of algorithm and statistic. See topGO documentation:

resultFisher <- runTest(GOdata, algorithm = "classic", statistic = "fisher")

resultKS <- runTest(GOdata, algorithm = "classic", statistic = "ks")

fisherElim <- runTest(GOdata, algorithm = "elim", statistic = "fisher")

allRes <- GenTable(GOdata, classicFisher = resultFisher, classicKS = resultKS, fisherElim = fisherElim, orderBy = "fisherElim", ranksOf = "fisherElim", topNodes = 100)

showSigOfNodes(GOdata, score(resultFisher), firstSigNodes = 10, useInfo = "all")

print(allRes)
```